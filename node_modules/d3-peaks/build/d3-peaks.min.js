!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.d3_peaks=n.d3_peaks||{})}(this,function(n){"use strict";function t(){var n=1,t=function(t){var r=t*t,i=n*n,e=2/(Math.sqrt(3*n)*Math.pow(Math.PI,.25)),o=1-r/i,u=Math.exp(-r/(2*i));return e*o*u};return t.std=function(r){return arguments.length?(n=r,t):n},t.reach=function(){return 5*n},t}function r(){function n(n){n=+n;for(var t=-1,r=2*n+1,i=new Array(r);++t<r;)i[t]=-n+t;return i}function r(t,r,i,e){for(var o=1;r>=o;o++){var u=t-o,f=t+o;if(!(u>=i&&e>=f))return n(o-1)}return n(r)}var i=t(),e=function(n){for(var t=n.length,e=-1,o=new Array(t);++e<t;){var u=0,f=r(e,i.reach(),0,t-1);f.forEach(function(t){var r=e+t;u+=n[r]*i(t)}),o[e]=u}return o};return e.kernel=function(n){return arguments.length?(i=n,e):i},e}function i(n,t){var r=n[t],i=n[t-1],e=n[t+1];if(void 0!==i&&void 0!==e){if(r>i&&r>e)return!0;if(r>=i&&r>e)return!0;if(r>i&&r>=e)return!0}else{if(void 0!==i&&r>i)return!0;if(void 0!==e&&r>e)return!0}return!1}function e(n){var t=[];return n.forEach(function(r,e){i(n,e)&&t.push({x:e,y:r})}),t}function o(n,t,r){var i={};t.forEach(function(n){i[n.x]=n.y});for(var e=n.top(),o=0;r>=o;o++){var u=e.x+o,f=e.x-o;if(u in i&&f in i)return i[u]>i[f]?u:f;if(u in i)return u;if(f in i)return f}return null}function u(n,t){var r=n.length,i=Math.min(r-1,Math.ceil(t*r));return n.sort(function(n,t){return n-t}),n[i]}function f(n,t,r){this.x=n,this.y=t,this.width=r,this.snr=void 0}function h(){this.points=[],this.gap=0}function a(){var n=t,i=1,u=1,a=1,c=[1],s=function(n){var t=v(n),r=p(t);return r=d(t,r),r=l(n,r),g(n,r)};s.kernel=function(t){return arguments.length?(n=t,s):n},s.widths=function(n){return n.sort(function(n,t){return n-t}),arguments.length?(c=n,s):c},s.gapThreshold=function(n){return arguments.length?(i=n,s):i},s.minLineLength=function(n){return arguments.length?(u=n,s):u},s.minSNR=function(n){return arguments.length?(a=n,s):a};var v=function(t){var i=new Array(c.length);return c.forEach(function(e,o){var u=n().std(e),f=r().kernel(u),h=f(t);i[o]=h}),i},p=function(n){var t=c.length,r=e(n[t-1],c[t-1]),i=[];return r.forEach(function(n){var r=new f(n.x,n.y,c[t-1]),e=new h;e.add(r),i.push(e)}),i},d=function(n,t){for(var r=c.length,u=r-2;u>=0;u--){var a=e(n[u],c[u]),s=[];t.forEach(function(t,r){var i=o(t,a,c[u]);t.add(null===i?null:new f(i,n[u][i],c[u])),null!==i&&s.push(i)}),t=t.filter(function(n){return!n.isDisconnected(i)}),a.forEach(function(n){if(-1===s.indexOf(n.x)){var r=new f(n.x,n.y,c[u]),i=new h;i.add(r),t.push(i)}})}return t},l=function(t,i){var e=n().std(1),o=r().kernel(e),f=o(t);return i=i.filter(function(n){var t=n.SNR(f);return t>=a&&n.length()>=u})},g=function(n,t){var r=t.map(function(t){var r=t.points,i=Number.NEGATIVE_INFINITY,e=void 0;return r.forEach(function(t){var r=n[t.x];r>i&&(e=t,i=r)}),e.serialize()});return r};return s}f.prototype.SNR=function(n){var t=1e-5,r=this.y,i=Math.max(0,this.x-this.width),e=Math.min(n.length,this.x+this.width+1),o=n.slice(i,e),f=u(o,.95);return r+=t,f+=t,this.snr=r/f,this.snr},f.prototype.serialize=function(){return{index:this.x,width:this.width,snr:this.snr}},h.prototype.add=function(n){return null===n||void 0===n?void(this.gap+=1):(this.points.push(n),void(this.gap=0))},h.prototype.top=function(){return this.points[this.points.length-1]},h.prototype.length=function(){return this.points.length},h.prototype.isDisconnected=function(n){return this.gap>n},h.prototype.SNR=function(n){var t=Number.NEGATIVE_INFINITY;return this.points.forEach(function(r){var i=r.SNR(n);i>t&&(t=i)}),t};var c="0.0.1";n.version=c,n.ricker=t,n.convolve=r,n.findPeaks=a});